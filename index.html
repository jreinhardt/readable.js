<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8"/>
		<script src="http://code.jquery.com/jquery-1.8.3.min.js" type="text/javascript"></script>
		<script src="readable.js" type="text/javascript"></script>
		<script src="http://d3js.org/d3.v2.js"></script>

		<script type="text/javascript">

			REFERENCES = [
				{name: 'Declaration of Independence', values: [48.1, 12.0, 13.9, 14.9, 13.3]},
				{name: 'Alice in Wonderland', values: [80.8, 5.7, 6.0, 8.6, 7.7]},
				{name: 'I have a Dream', values: [67.7, 8.0, 8.3, 11.2, 10.6]},
				{name: 'Critique of pure Reason', values: [47.8, 11.7, 12.8, 14.6, 13.3]},
				{name: 'Typical "The Sun" Article', values: [78.1, 6.7, 5.0, 8.0, 8.5]}
			]

			/*
			idx is the index into the values array of References
			*/
			var metrics = [{name: 'FleschKincaid', idx: 0, scale: 2,
					score: function(text) {return text.getFleschKincaidIndex()}, 
					descr: "The Flesch Reading Ease test depends on the number of words per sentence and the number of syllables per word. Higher values indicate a better readability.",
					link: "http://en.wikipedia.org/wiki/Fleschâ€“Kincaid_Readability_Test"},
				{name: 'ColemanLiau', idx: 1, scale: 15,
					score: function(text) {return text.getColemanLiauIndex()},
					descr: "The Coleman-Liau index depends on the length of the words and the number of words per sentence. Lower values indicate a better readability.",
					link: "http://en.wikipedia.org/wiki/Coleman-Liau_index"},
				{name: 'AutomatedReadability', idx: 2, scale: 15,
					score: function(text) {return text.getAutomatedReadabilityIndex()},
					descr: "The Automated Readability Index depends on length of the words and the number of words per sentence. Lower values indicate a better readability.",
					link: "http://en.wikipedia.org/wiki/Automated_Readability_Index"},
				{name: 'GunningFog', idx: 3, scale: 15,
					score: function(text) {return text.getGunningFogIndex()},
					descr: "The Gunning-Fog index depends on the number of words per sentence and the number of complex words. Lower values indicate a better readability.",
					link: "http://en.wikipedia.org/wiki/Gunning-Fog_Index"},
				{name: 'SMOG', idx: 4, scale: 15,
					score: function(text) {return text.getSmogGrade()},
					descr: "The SMOG grade depends on the number of complex words per sentence. Lower values indicate a better readability.",
					link: "http://en.wikipedia.org/wiki/SMOG"}
			];
			/*
			Auto-update with typing time-out.
			*/
			var autoUpdateTimer;
			var AUTO_UPDATE_TIMEOUT = 500; // in ms

			$(document).ready(function() {
				for(var i=0;i<metrics.length;i++){
					data = [{name: "Your Text", value: 1}];
					for (var j = 0; j < REFERENCES.length; j++) {
						data[data.length] = {name: REFERENCES[j].name, value: 1};
					}
					d3.select('#results').append("div").attr('id',metrics[i].name).append("h2").html(metrics[i].name);
					d3.select('#' + metrics[i].name).append('div').html(metrics[i].descr)
					var chart = d3.select('#' + metrics[i].name).append("svg").attr("height",(REFERENCES.length+1)*20).attr("width",600).attr("class","chart");
					
					chart.selectAll("rect").data(data)
						.enter().append("rect")
						.attr("x", function(d,i) {return 0})
						.attr("y", function(d,i) {return 20*i})
						.attr("width", function(d,i) {return d.value})
						.attr("height", function(d,i) {return 18})
					chart.selectAll("text").data(data)
						.enter().append("text")
						.attr("x", function(d,i) {return 600})
						.attr("y", function(d,i) {return 20*(i+1)-2})
						.attr("text-anchor","end").text(function(d,i) {return d.name});
				}
				$('#text').on('input paste', function() {
					clearTimeout(autoUpdateTimer);
					if ($('#text').val) {
						autoUpdateTimer = setTimeout(update, AUTO_UPDATE_TIMEOUT);
					}
				});
			});

			function updateTable(table, value, j, scale) {
				data = [{name: "Your Text", value: value}];
				for (var i = 0; i < REFERENCES.length; i++) {
					data[data.length] = {name: REFERENCES[i].name, value: REFERENCES[i].values[j]};
				}

				var chart = d3.select('#' + table).select("svg")
				chart.selectAll("rect").data(data)
					.transition().duration(500)
					.attr("x", function(d,i) {return 0})
					.attr("y", function(d,i) {return 20*i})
					.attr("width", function(d,i) {return Math.max(1,d.value*scale)})
					.attr("height", function(d,i) {return 18})
				chart.selectAll("text").data(data)
					.attr("x", function(d,i) {return 600})
					.attr("y", function(d,i) {return 20*(i+1)-2})
					.attr("text-anchor","end").text(function(d,i) {return d.name});
			}

			function update(evt) {
				var text = Text(document.form.text.value);
				for (var i=0;i<metrics.length;i++){
					updateTable(metrics[i].name, metrics[i].score(text), metrics[i].idx, metrics[i].scale);
				}

			}

		</script>

		<style type="text/css">

			#content {
				width:600px;
				margin:0 auto 0 auto;
			}

			svg.chart rect{
				stroke: white;
				fill: steelblue;
			}

			svg.chart text{
				fill: black;
			}

			#content div h2 {
				position:relative;
				color: steelblue;
			}
			#content div h2 span {
				display: none;
			}

			#content div h2:hover span {
				font-size: 0.6em;
				display: block;
				position: absolute;
				background-color: white;
				color: black;
			}

		</style>
	</head>

	<body>

		<div id="content">

			<h1>readable.js</h1>

			<p><i>readable.js</i> is a Javascript library for
			readability analysis. Get it <a href="http://www.github.com/jreinhardt/readable.js">on github</a>.</p>

			<h2>Try it now!</h2>
			<p>Type or paste a text and see how readable it is compared to other
			texts:</p>
			<form name="form">
				<textarea name="text" id="text" cols="80" rows="10"></textarea>
			</form>

			<div id="results"></div>
		</div>

		<!-- Javascript support check -->
		<div id="no_javascript" style="border:1px solid #f00;">This site requires JavaScript. Please enable JavaScript-support in your browser.</div>
		<script type="text/javascript">
			element = document.getElementById("no_javascript");
			element.parentNode.removeChild(element);
			$('#content').show();
		</script>

	</body>
</html>
