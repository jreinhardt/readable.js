<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8"/>
		<script src="http://code.jquery.com/jquery-1.8.3.min.js" type="text/javascript"></script>
		<script src="readable.js" type="text/javascript"></script>
		<script src="http://d3js.org/d3.v2.js"></script>

		<script type="text/javascript">

			REFERENCES = [
				{name: 'Declaration of Independence', values: [48.1, 12.0, 13.9, 14.9, 13.3]},
				{name: 'Alice in Wonderland', values: [80.8, 5.7, 6.0, 8.6, 7.7]},
				{name: 'I have a Dream', values: [67.7, 8.0, 8.3, 11.2, 10.6]},
				{name: 'Critique of pure Reason', values: [47.8, 11.7, 12.8, 14.6, 13.3]},
				{name: 'Typical "The Sun" Article', values: [78.1, 6.7, 5.0, 8.0, 8.5]}
			]

			/*
			idx is the index into the values array of References
			*/
			var metrics = [/*{name: 'FleschKincaid', idx: 0, scale: 2,
					score: function(text) {return text.getFleschKincaidIndex()}, 
					descr: "The Flesch Reading Ease test depends on the number of words per sentence and the number of syllables per word. Higher values indicate a better readability.",
					link: "http://en.wikipedia.org/wiki/Fleschâ€“Kincaid_Readability_Test"},*/
				{name: 'ColemanLiau', idx: 1, scale: 15,
					score: function(text) {return text.getColemanLiauIndex()},
					descr: "The Coleman-Liau index depends on the length of the words and the number of words per sentence. Lower values indicate a better readability.",
					link: "http://en.wikipedia.org/wiki/Coleman-Liau_index"},
				{name: 'AutomatedReadability', idx: 2, scale: 15,
					score: function(text) {return text.getAutomatedReadabilityIndex()},
					descr: "The Automated Readability Index depends on length of the words and the number of words per sentence. Lower values indicate a better readability.",
					link: "http://en.wikipedia.org/wiki/Automated_Readability_Index"},
				{name: 'GunningFog', idx: 3, scale: 15,
					score: function(text) {return text.getGunningFogIndex()},
					descr: "The Gunning-Fog index depends on the number of words per sentence and the number of complex words. Lower values indicate a better readability.",
					link: "http://en.wikipedia.org/wiki/Gunning-Fog_Index"},
				{name: 'SMOG', idx: 4, scale: 15,
					score: function(text) {return text.getSmogGrade()},
					descr: "The SMOG grade depends on the number of complex words per sentence. Lower values indicate a better readability.",
					link: "http://en.wikipedia.org/wiki/SMOG"}
			];
			/*
			Auto-update with typing time-out.
			*/
			var autoUpdateTimer;
			var AUTO_UPDATE_TIMEOUT = 500; // in ms
			var data;

			/* Find the idx for entry for a text in data from the texts name */
			function findIdx(data,name){
				for(var i=0;i<data.length;i++){
					if(data[i].name == name){
						return i;
					}
				}
				return -1;
			}

			function compareTexts(a,b) {
				if(a.minValue < b.minValue){
					return -1;
				}
				if(a.minValue > b.minValue){
					return 1;
				}
				return 0;
			}

			function setup_data(){
				data = [{name: "Your Text", minValue: 0, minMetric:"None", maxValue: 0, maxMetric: "None"}];
				for (var j = 0; j < REFERENCES.length; j++) {
					var ref_data = {name: REFERENCES[j].name,
						 minValue: REFERENCES[j].values[metrics[0].idx], minMetric: metrics[0].name,
						 maxValue: REFERENCES[j].values[metrics[0].idx], maxMetric: metrics[0].name};
					for(var i=1;i<metrics.length;i++){
						if(ref_data.minValue > REFERENCES[j].values[metrics[i].idx]){
							ref_data.minValue = REFERENCES[j].values[metrics[i].idx];
							ref_data.minMetric = metrics[i].name;
						}
						if(ref_data.maxValue < REFERENCES[j].values[metrics[i].idx]){
							ref_data.maxValue = REFERENCES[j].values[metrics[i].idx];
							ref_data.maxMetric = metrics[i].name;
						}
					}
					data.push(ref_data);
				}
				return data;
			}

			$(document).ready(function() {

				//Prepare Description
				var legend = d3.selectAll('#legend');
				legend.selectAll("div").data(metrics).enter().append("div").attr("class","description");
				legend.selectAll("div.description").data(metrics).append("h2").text(function(d,i){return d.name;});
				legend.selectAll("div.description").data(metrics).append("div").text(function(d,i){return d.descr;});

				//Prepare chart
				var chart = d3.select('#results').append("svg").attr("height",(REFERENCES.length+1)*20).attr("width",600).attr("class","chart");
				data = setup_data();

				data.sort(compareTexts);

				chart.selectAll("rect.maxValue").data(data, function(d){return d.name;})
					.enter().append("rect")
					.attr("class","maxValue")
					.attr("x", function(d,i) {return 0})
					.attr("y", function(d,i) {return 20*i})
					.attr("width", function(d,i) {return  Math.max(1,d.maxValue*15)})
					.attr("height", function(d,i) {return 18});

				chart.selectAll("text.maxValue").data(data, function(d){return d.name;})
					.enter().append("text")
					.attr("class","maxValue")
					.attr("x", function(d,i) {return Math.max(1,d.maxValue*15)})
					.attr("y", function(d,i) {return 20*i})
					.attr("dx", -3) // padding-right
					.attr("dy", ".85em") // vertical-align: middle
					.attr("text-anchor","end")
					.text(function(d,i) {return d.maxMetric[0]});

				chart.selectAll("rect.minValue").data(data, function(d){return d.name;})
					.enter().append("rect")
					.attr("class","minValue")
					.attr("x", function(d,i) {return 0})
					.attr("y", function(d,i) {return 20*i})
					.attr("width", function(d,i) {return  Math.max(1,d.minValue*15)})
					.attr("height", function(d,i) {return 18});

				chart.selectAll("text.minValue").data(data, function(d){return d.name;})
					.enter().append("text")
					.attr("class","minValue")
					.attr("x", function(d,i) {return Math.max(1,d.minValue*15)})
					.attr("y", function(d,i) {return 20*i})
					.attr("dx", -3) // padding-right
					.attr("dy", ".85em") // vertical-align: middle
					.attr("text-anchor","end")
					.text(function(d,i) {return d.minMetric[0]});

				chart.selectAll("text.label").data(data)
					.enter().append("text")
					.attr("class","label")
					.attr("x", function(d,i) {return 600})
					.attr("y", function(d,i) {return 20*(i+1)-2})
					.attr("text-anchor","end").text(function(d,i) {return d.name});

				//Prepare update timer
				$('#text').on('input paste', function() {
					clearTimeout(autoUpdateTimer);
					if ($('#text').val) {
						autoUpdateTimer = setTimeout(update, AUTO_UPDATE_TIMEOUT);
					}
				});
			});

			function update(evt) {
				var text = Text(document.form.text.value);
				var myText = data[findIdx(data,"Your Text")];
				myText.minValue = metrics[0].score(text);
				myText.minMetric = metrics[0].name;
				myText.maxValue = metrics[0].score(text);
				myText.maxMetric = metrics[0].name;
				for(var i=1;i<metrics.length;i++){
					if(myText.minValue > metrics[i].score(text)){
						myText.minValue = metrics[i].score(text);
						myText.minMetric = metrics[i].name;
					}
					if(myText.maxValue < metrics[i].score(text)){
						myText.maxValue = metrics[i].score(text);
						myText.maxMetric = metrics[i].name;
					}
				}

				data.sort(compareTexts);

				var chart = d3.select('#results').select("svg")
				//Max Value boxes
				chart.selectAll("rect.maxValue").data(data, function(d){return d.name;})
					.transition().duration(500)
					.attr("y", function(d,i) {return 20*i})
					.attr("width", function(d,i) {return Math.max(1,d.maxValue*15)})
					.attr("height", function(d,i) {return 18});
				//Max Value metric name
				chart.selectAll("text.maxValue").data(data, function(d){return d.name;})
					.transition().duration(500)
					.attr("x", function(d,i) {return Math.max(1,d.maxValue*15)})
					.attr("y", function(d,i) {return 20*i})
					.attr("text-anchor","end").text(function(d,i) {return d.maxMetric[0]});
				//Min Value boxes
				chart.selectAll("rect.minValue").data(data, function(d){return d.name;})
					.transition().duration(500)
					.attr("y", function(d,i) {return 20*i})
					.attr("width", function(d,i) {return Math.max(1,d.minValue*15)})
					.attr("height", function(d,i) {return 18});
				//Min Value metric name
				chart.selectAll("text.minValue").data(data, function(d){return d.name;})
					.transition().duration(500)
					.attr("x", function(d,i) {return Math.max(1,d.minValue*15)})
					.attr("y", function(d,i) {return 20*i})
					.attr("text-anchor","end").text(function(d,i) {return d.minMetric[0]});
				//Text name
				chart.selectAll("text.label").data(data, function(d){return d.name;})
					.transition().duration(500)
					.attr("x", function(d,i) {return 600})
					.attr("y", function(d,i) {return 20*(i+1)-2})
					.attr("text-anchor","end").text(function(d,i) {return d.name});
			}

		</script>

		<style type="text/css">

			#content {
				width:600px;
				margin:0 auto 0 auto;
			}

			svg.chart rect.minValue{
				stroke: white;
				fill: steelblue;
			}

			svg.chart rect.maxValue{
				stroke: white;
				fill: lightblue;
			}

			svg.chart text{
				fill: black;
			}

			#content div h2 {
				position:relative;
				color: steelblue;
			}
			#content div h2 span {
				display: none;
			}

			#content div h2:hover span {
				font-size: 0.6em;
				display: block;
				position: absolute;
				background-color: white;
				color: black;
			}

		</style>
	</head>

	<body>

		<div id="content">

			<h1>readable.js</h1>

			<p><i>readable.js</i> is a Javascript library for
			readability analysis. Get it <a href="http://www.github.com/jreinhardt/readable.js">on github</a>.</p>

			<h2>Try it now!</h2>
			<p>Type or paste a text and see how readable it is compared to other
			texts:</p>
			<form name="form">
				<textarea name="text" id="text" cols="80" rows="10"></textarea>
			</form>

			<div id="results"></div>
			<div id="legend"></div>
		</div>

		<!-- Javascript support check -->
		<div id="no_javascript" style="border:1px solid #f00;">This site requires JavaScript. Please enable JavaScript-support in your browser.</div>
		<script type="text/javascript">
			element = document.getElementById("no_javascript");
			element.parentNode.removeChild(element);
			$('#content').show();
		</script>

	</body>
</html>
